(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,l,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(3212)}])},3212:function(e,l,s){"use strict";s.r(l),s.d(l,{default:function(){return Z}});var n=s(5893),i=s(6979),t=s(4418),r=s(302),o=s(7754),a=s(295),x=s(6154),d=s(7294),c=s(4238),h=s(204),u=s(3100),j=s(9564),p=s(7523),g=s(1649),m=s(5434);function f(){let[e,l]=(0,d.useState)(0);return(0,d.useEffect)(()=>{let e=setInterval(()=>{l(e=>e>=3?0:e+1)},300);return()=>clearInterval(e)},[]),(0,n.jsx)(n.Fragment,{children:".".repeat(e)})}var b=s(4151),y=s(5291),v=s(4629),z=s(191),C=s(3438),S=s(6880);function W(e){let{app:l,open:s,onClose:i}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(b.u_,{isOpen:s,onClose:i,children:[(0,n.jsx)(y.Z,{}),(0,n.jsxs)(v.h,{children:[(0,n.jsx)(z.x,{children:"Log de erro"}),(0,n.jsx)(C.o,{}),(0,n.jsx)(S.f,{pb:6,overflow:"auto",children:(0,n.jsx)("pre",{children:l.deployError})})]})]})})}function k(e){let{app:l,open:s,onClose:i}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(b.u_,{isOpen:s,onClose:i,children:[(0,n.jsx)(y.Z,{}),(0,n.jsxs)(v.h,{children:[(0,n.jsx)(z.x,{children:"Informa\xe7\xf5es"}),(0,n.jsx)(C.o,{}),(0,n.jsxs)(S.f,{pb:6,overflow:"auto",children:[(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"Nome"}),(0,n.jsx)(j.x,{fontWeight:400,children:l.displayName}),(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"ID"}),(0,n.jsx)(j.x,{fontWeight:400,children:l.id}),(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"Git Branch"}),(0,n.jsx)(j.x,{fontWeight:400,children:l.gitBranch}),(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"Diret\xf3rio"}),(0,n.jsx)(j.x,{fontWeight:400,children:l.folderAbsolutePath}),(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"Diret\xf3rio de backups"}),(0,n.jsx)(j.x,{fontWeight:400,children:l.backupAbsolutePath}),(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"Nome do servi\xe7o do systemd"}),(0,n.jsx)(j.x,{fontWeight:400,children:l.systemdServiceName}),(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"Desfazer deploy quando falhar"}),(0,n.jsx)(j.x,{fontWeight:400,children:l.undoWhenFailed?"Sim":"N\xe3o"}),(0,n.jsx)(j.x,{fontSize:"lg",fontWeight:700,mt:2,children:"Comandos"}),(0,n.jsxs)(j.x,{children:[(0,n.jsx)("b",{children:"Parar aplica\xe7\xe3o:"})," ",l.stopCommand]}),(0,n.jsxs)(j.x,{children:[(0,n.jsx)("b",{children:"Iniciar aplica\xe7\xe3o:"})," ",l.startCommand]}),(0,n.jsxs)(j.x,{children:[(0,n.jsx)("b",{children:"Resetar reposit\xf3rio:"})," ",l.resetCommand]}),(0,n.jsxs)(j.x,{children:[(0,n.jsx)("b",{children:"Limpar arquivos:"})," ",l.cleanCommand]}),(0,n.jsxs)(j.x,{children:[(0,n.jsx)("b",{children:"Baixar atualiza\xe7\xf5es:"})," ",l.pullCommand]}),(0,n.jsxs)(j.x,{children:[(0,n.jsx)("b",{children:"Instalar depend\xeancias:"})," ",l.installCommand]}),(0,n.jsxs)(j.x,{children:[(0,n.jsx)("b",{children:"Fazer o build:"})," ",l.buildCommand]})]})]})]})})}var F=s(6953),I=s(6303),E=s(6887),w=s(989);function _(e){let{log:l,open:s,onClose:i}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(b.u_,{isOpen:s,onClose:i,children:[(0,n.jsx)(y.Z,{}),(0,n.jsxs)(v.h,{w:"full",maxW:"6xl",children:[(0,n.jsx)(z.x,{children:"Visualizador de logs"}),(0,n.jsx)(C.o,{}),(0,n.jsx)(S.f,{pb:6,overflow:"auto",children:(0,n.jsx)("pre",{children:l})})]})]})})}function N(e){let{logs:l}=e,[s,i]=(0,d.useState)("");return(0,n.jsxs)(F.v,{isLazy:!0,children:[(0,n.jsx)(p.u,{label:"Logs",children:(0,n.jsx)(I.j,{children:(0,n.jsx)(r.h,{"aria-label":"Logs",variant:"ghost",ml:2,color:"inherit",children:(0,n.jsx)(m.gbF,{size:24})})})}),(0,n.jsxs)(E.q,{zIndex:"2",children:[(0,n.jsxs)(w.s,{icon:(0,n.jsx)(m.gbF,{}),onClick:()=>i("reset"),children:["Reset logs (",Math.max(0,l.reset.split("\n").length-1),")"]}),(0,n.jsxs)(w.s,{icon:(0,n.jsx)(m.gbF,{}),onClick:()=>i("clean"),children:["Clean logs (",Math.max(0,l.clean.split("\n").length-1),")"]}),(0,n.jsxs)(w.s,{icon:(0,n.jsx)(m.gbF,{}),onClick:()=>i("pull"),children:["Pull logs (",Math.max(0,l.pull.split("\n").length-1),")"]}),(0,n.jsxs)(w.s,{icon:(0,n.jsx)(m.gbF,{}),onClick:()=>i("install"),children:["Install logs (",Math.max(0,l.install.split("\n").length-1),")"]}),(0,n.jsxs)(w.s,{icon:(0,n.jsx)(m.gbF,{}),onClick:()=>i("build"),children:["Build logs (",Math.max(0,l.build.split("\n").length-1),")"]})]}),(0,n.jsx)(_,{open:"reset"===s,log:l.reset,onClose:()=>i("")}),(0,n.jsx)(_,{open:"clean"===s,log:l.clean,onClose:()=>i("")}),(0,n.jsx)(_,{open:"pull"===s,log:l.pull,onClose:()=>i("")}),(0,n.jsx)(_,{open:"install"===s,log:l.install,onClose:()=>i("")}),(0,n.jsx)(_,{open:"build"===s,log:l.build,onClose:()=>i("")})]})}let D={stop:[0,"Parando aplica\xe7\xe3o","blue",m.l74,!0,0],backup:[5,"Fazendo backup","blue",m.fg0,!0,0],backupBroken:[5,"Fazendo backup do servidor com problemas","orange",m.fg0,!0,0],reset:[20,"Resetando c\xf3digos","blue",m.Zgl,!0,0],clean:[23,"Limpando arquivos extras","blue",m.Zgl,!0,0],pull:[26,"Baixando vers\xe3o mais recente","blue",m.qm7,!0,0],install:[35,"Instalando depend\xeancias","blue",m.RUY,!0,0],build:[70,"Fazendo build","blue",m.b9P,!0,0],start:[95,"Iniciando aplica\xe7\xe3o","blue",m.Nhx,!0,0],undo:[0,"Desfazendo altera\xe7\xf5es","orange",m.TsG,!0,0],error:[100,"Erro ao fazer deploy","red",m.Fbu,!1,2],restored:[100,"Deploy restaurado","orange",m.wI4,!1,2],success:[100,"Deploy finalizado com sucesso","green",m.vB0,!1,2],none:[0,"Aguardando deployments","gray",m.uAz,!1,3],queue:[0,"Em fila","gray",m.gye,!1,1]};function R(e){let{app:l}=e,s=l.pendingDeploy&&!D[l.status][4]?"queue":l.status,[i,t,o,a,x]=D[s];return(0,n.jsxs)(c.Z,{p:3,color:o+".500",position:"relative",transition:".3s ease",mb:5,style:{clear:"both"},children:[(0,n.jsxs)(h.k,{gap:3,children:[(0,n.jsx)(h.k,{align:"center",display:["none","flex"],children:(0,n.jsx)(u.xu,{p:4,borderColor:o+".500",borderWidth:2,borderRadius:"full",children:(0,n.jsx)(a,{size:40})})}),(0,n.jsxs)(u.xu,{flex:"1",children:[(0,n.jsxs)(j.x,{fontSize:"2xl",display:"flex",alignItems:"center",flexWrap:"wrap",children:[l.displayName,(0,n.jsx)(g.gxx,{style:{marginLeft:"10px",marginRight:"4px"}}),(0,n.jsx)(j.x,{fontWeight:500,children:l.gitBranch})]}),(0,n.jsxs)(j.x,{display:"flex",alignItems:"center",children:[(0,n.jsx)(m.Wi4,{style:{marginRight:"4px"}}),l.folderAbsolutePath]}),(0,n.jsxs)(j.x,{display:"flex",alignItems:"center",hidden:!l.deployStartTime,children:[(0,n.jsx)(g.i95,{style:{marginRight:"4px"}}),new Date(l.deployStartTime).toLocaleString()]}),(0,n.jsxs)(j.x,{display:"flex",alignItems:"center",hidden:!l.deployTime,children:[(0,n.jsx)(m.dKE,{style:{marginRight:"4px"}}),"Tempo: ",l.deployTime," segundos"]}),(0,n.jsxs)(j.x,{display:"flex",alignItems:"center",hidden:"queue"===s||!l.pendingDeploy,children:[(0,n.jsx)(m.gye,{style:{marginRight:"4px"}}),"Outro deploy em fila"]}),(0,n.jsxs)(j.x,{fontSize:"md",fontWeight:200,children:[t,x&&(0,n.jsx)(f,{})]})]}),(0,n.jsxs)(h.k,{align:"center",direction:["column","row"],children:[(0,n.jsx)(L,{app:l}),(0,n.jsx)(N,{logs:l.logs}),(0,n.jsx)(p.u,{label:"Editar",children:(0,n.jsx)(r.h,{"aria-label":"Editar",variant:"ghost",ml:2,color:"inherit",children:(0,n.jsx)(m.zmo,{size:24})})}),(0,n.jsx)(q,{app:l})]})]}),(0,n.jsx)(u.xu,{position:"absolute",left:"0",top:"0",bg:o+".100",opacity:.3,w:i+"%",h:"full",zIndex:0,pointerEvents:"none",transition:"all .3s ease, width 2s ease",borderRadius:"var(--card-radius)"})]})}function L(e){let{app:l}=e,[s,i]=(0,d.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.u,{label:"Log de erro",children:(0,n.jsx)(r.h,{"aria-label":"Log de erro",variant:"ghost",ml:2,color:"red.500",onClick:()=>i(!0),hidden:!l.deployError,children:(0,n.jsx)(m.Fbu,{size:24})})}),(0,n.jsx)(W,{app:l,open:s,onClose:()=>i(!1)})]})}function q(e){let{app:l}=e,[s,i]=(0,d.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.u,{label:"Informa\xe7\xf5es",children:(0,n.jsx)(r.h,{"aria-label":"Informa\xe7\xf5es",variant:"ghost",ml:2,color:"inherit",onClick:()=>i(!0),children:(0,n.jsx)(m.I5p,{size:24})})}),(0,n.jsx)(k,{app:l,open:s,onClose:()=>i(!1)})]})}var P=s(483);function B(e){let{setData:l}=e,s=(0,P.useEventSource)({source:"realtime",options:{withCredentials:!0}});return(0,P.useEventSourceListener)({source:s,startOnInit:!0,event:{name:"update",listener:e=>{let{data:s}=e,{id:n,data:i}=s;for(let e of i){let[s,i]=e;l(e=>{if(!e)return e;let l=e.apps.map(e=>(null==e?void 0:e.id)!==n?e:(s.startsWith("logs.")?(e.logs[s.slice(5)]=i,e.logs={...e.logs}):e[s]=i,{...e}));return{...e,apps:[...l]}})}}}},[s]),null}var O=s(9008),T=s.n(O);function Z(){var e,l;let[s,c]=(0,d.useState)(),[h,u]=(0,d.useState)(!0),[j,p]=(0,d.useState)(),g=()=>{u(!0),p(null),x.Z.get("state").then(e=>{let{data:l}=e;c(l)}).catch(e=>{p(e)}).finally(()=>{u(!1)})};(0,d.useEffect)(()=>{g()},[]);let f=null==s?void 0:s.apps.sort((e,l)=>e.displayName.localeCompare(l.displayName)).sort((e,l)=>{let s=e.pendingDeploy&&!D[e.status][4]?"queue":e.status,n=l.pendingDeploy&&!D[l.status][4]?"queue":l.status;return D[s][5]-D[n][5]});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T(),{children:(0,n.jsx)("title",{children:"Sistema de deploy autom\xe1tico via GitHub"})}),(0,n.jsxs)(i.W,{maxW:"5xl",my:5,children:[(0,n.jsxs)(t.X,{fontWeight:500,mb:5,children:[(0,n.jsx)(r.h,{"aria-label":"Atualizar",onClick:g,variant:"ghost",float:"right",ml:3,children:(0,n.jsx)(m.la_,{size:24})}),"Sistema de deploy autom\xe1tico via GitHub"," "]}),h&&(0,n.jsx)(o.M,{my:10,style:{clear:"both"},children:(0,n.jsx)(a.$,{})}),j&&(0,n.jsxs)(n.Fragment,{children:["ERRO: ",(null==j?void 0:null===(e=j.response)||void 0===e?void 0:null===(l=e.data)||void 0===l?void 0:l.message)||(null==j?void 0:j.message)]}),!h&&!j&&(null==f?void 0:f.map(e=>(0,n.jsx)(R,{app:e},e.id))),(0,n.jsx)(B,{setData:c})]})]})}}},function(e){e.O(0,[228,866,712,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);